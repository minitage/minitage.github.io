
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Minitage, le meta gestionnaire de paquets &mdash; Minitage - Last updated: Sep 10, 2013</title>
    <link rel="stylesheet" href="static/custom.css" type="text/css" />
    <link rel="stylesheet" href="static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     'Last updated: Sep 10, 2013',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="static/jquery.js"></script>
    <script type="text/javascript" src="static/underscore.js"></script>
    <script type="text/javascript" src="static/doctools.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Search within Minitage - Last updated: Sep 10, 2013"
          href="static/opensearch.xml"/>
    <link rel="shortcut icon" href="static/favicon.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="top" title="Minitage - Last updated: Sep 10, 2013" href="index.html" />
    <script src="static/jquery.min.js" type="text/javascript"></script>
    <script src="static/jquery.zrssfeed.min.js" type="text/javascript"></script>

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="index.html">Minitage - Last updated: Sep 10, 2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="document">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="static/logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
<h3><a href="index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="why.html">What is minitage</a></li>
<li class="toctree-l1"><a class="reference internal" href="spec.html">Minitage components explained</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation_prerequisite.html">System Prerequisites</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="minitagetool.html">minitagetool : Usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usecases/index.html">Minitage advanced usage</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="paster/index.html">Minitage and paster templates: projects &amp; instances</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="develop.html">Develop</a></li>
<li class="toctree-l1"><a class="reference internal" href="develop.html#credits">Credits</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="archives.html">Archives index</a></li>
</ul>

        </div>
      </div>
  <script type="text/javascript">

/*
  $(document).ready(function () {
      $('#zrssfeed-minitage-dependencies').rssfeed('https://github.com/minitage-dependencies.atom', {
          limit: 5
      });
  });
  $(document).ready(function () {
      $('#zrssfeed-minitage-eggs').rssfeed('https://github.com/minitage-eggs.atom', {
          limit: 5
      });
  });
  $(document).ready(function () {
      $('#zrssfeed-minitage').rssfeed('https://github.com/minitage.atom', {
          limit: 5
      });
  });
  $(document).ready(function () {
      $('#zrssfeed-kiorky').rssfeed('https://github.com/kiorky.atom', {
          limit: 5
      });
  }); 
  */
  </script>
  <div class="documentwrapper">
  <!-- 
    <div id="zrssfeed">
      <div id="zrssfeed-minitage"></div>
      <div id="zrssfeed-minitage-dependencies"></div>
      <div id="zrssfeed-minitage-eggs"></div>
      <div id="zrssfeed-kiorky"></div>
    </div>   -->
    <div class="bodywrapper">
      <div class="body">
        
  <div class="section" id="minitage-le-meta-gestionnaire-de-paquets">
<h1>Minitage, le meta gestionnaire de paquets<a class="headerlink" href="#minitage-le-meta-gestionnaire-de-paquets" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="le-vocabulaire">
<h1>Le vocabulaire<a class="headerlink" href="#le-vocabulaire" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>mini(port)tage : le meta gestionnaire de paquets</li>
<li>mini(e)merge: l&#8217;outil en ligne de commande qui controle une installation minitage</li>
</ul>
</div>
<div class="section" id="id1">
<h1>Le vocabulaire<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>mini(e)build: Format de paquets minitage</li>
<li>mini(over)lay: un conteneur de minibuilds habituellement placé dans minitage/minilays/[UN REPERTOIRE]</li>
</ul>
</div>
<div class="section" id="id2">
<h1>Le vocabulaire<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Un projet est une application dont un minibuild va spécifier comment l&#8217;intégrer dans minitage</li>
<li>Un profil est un scaffold de bases de données ou de wrappers qui permet de rendre le travail dans un projet minitagifié plus simple et précis.</li>
<li>zc.buildout: outil de déploiment modulaire écrit par Jim Fulton, le papa de Zope</li>
</ul>
</div>
<div class="section" id="les-fondammentaux">
<h1>Les fondammentaux<a class="headerlink" href="#les-fondammentaux" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Conceptuellement inspiré des systèmes de port (xBSD, gentoo, sourcemage)</li>
<li>Isolation des packages vis à vis du système hôte</li>
<li>Multiplateforme (Unix) (dans la réalité, surtout testé sur linux (multiple) &amp; MacOSX</li>
<li>Reproductiblité des déploiements</li>
</ul>
</div>
<div class="section" id="les-fondammentaux-2">
<h1>Les fondammentaux (2)<a class="headerlink" href="#les-fondammentaux-2" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Installation en production, préproduction et développement IDENTIQUE (mêmes versions, même layouts)</li>
<li>Rester bas niveau</li>
<li>Etre modulaire, configurable</li>
</ul>
</div>
<div class="section" id="les-fondammentaux-3">
<h1>Les fondammentaux (3)<a class="headerlink" href="#les-fondammentaux-3" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Avoir des mécanismes de mise à jour conservatifs</p>
<blockquote>
<ul class="simple">
<li>migration in place</li>
<li>on ne reinstalle pas un package déjà installé sauf demande explicite</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="les-fondammentaux-4">
<h1>Les fondammentaux (4)<a class="headerlink" href="#les-fondammentaux-4" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Les packages restent atomiques, ce qui n&#8217;est pas un projet n&#8217;installe qu&#8217;une chose</p>
<p>eg: postgresql-8,4 et postgis-1.5 sont deux packages différents, ils ne sont pas regroupés</p>
</li>
</ul>
</div>
<div class="section" id="qu-est-ce-qu-un-meta-package-manager">
<h1>Qu&#8217;est ce qu&#8217;un meta package-manager<a class="headerlink" href="#qu-est-ce-qu-un-meta-package-manager" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">minitage n&#8217;est qu&#8217;un ordonnanceur</p>
<blockquote>
<ul class="simple">
<li>Assembler les dépendances puis les télécharger et les construire</li>
</ul>
</blockquote>
</li>
<li><p class="first">ce qui est réellement utilisé en dessous est zc.buildout</p>
</li>
</ul>
</div>
<div class="section" id="most-important-all-is-project">
<h1>Most important, All is project<a class="headerlink" href="#most-important-all-is-project" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">project centric VS système centric</p>
</li>
<li><p class="first">Son but sur le système hote.</p>
<blockquote>
<ul class="simple">
<li>déployer</li>
<li>isoler</li>
<li>pérenniser le cycle de vie du projet</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="most-important-all-is-project-2">
<h1>Most important, All is project (2)<a class="headerlink" href="#most-important-all-is-project-2" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Intégration d&#8217;outils populaires dans une sous hierarchie du projet (/sys)
pour simplifier l&#8217;usage des dépendances confinées dans leur layout<ul>
<li>On installe une base de données PostgreSQL avec des wrappers comme &#8216;toto.psql&#8217;</li>
<li>&#8216;toto.psql&#8217; est préconfiguré pour se connecter à cette base de données</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="minitage-dur-a-apprehender-en-tant-que-developpeur">
<h1>minitage, dur à appréhender en tant que développeur?<a class="headerlink" href="#minitage-dur-a-apprehender-en-tant-que-developpeur" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">minitage en tant que développeur est simple dans les concepts, les prerequis le sont moins.</p>
<blockquote>
<ul class="simple">
<li>il faut avoir quelques notions de packaging (inter dépendances)</li>
<li>il faut avoir quelques notions de compilation, les flaggs de compil, les outils de compilation (autotools, scons, cmake)</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="minitage-dur-a-apprehender-en-tant-qu-utilisateur">
<h1>minitage, dur à appréhender en tant qu&#8217;utilisateur ?<a class="headerlink" href="#minitage-dur-a-apprehender-en-tant-qu-utilisateur" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="la-technique">
<h1>LA TECHNIQUE<a class="headerlink" href="#la-technique" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="un-layout-commun">
<h1>Un layout commun<a class="headerlink" href="#un-layout-commun" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">isolation == layout stricte</p>
</li>
<li><p class="first">Tout ce qui est installé dans minitage suit un scheme strict (cf <a class="reference external" href="http://www.minitage.org">http://www.minitage.org</a>)</p>
</li>
<li><p class="first">Tout package respecte la convention suivante:</p>
<div class="highlight-python"><pre>/minitage_root/category/package/</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="le-layout-pour-les-dependances-c-categorie-dependencies">
<h1>Le layout pour les dépendances C (categorie: dependencies)<a class="headerlink" href="#le-layout-pour-les-dependances-c-categorie-dependencies" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Structure commune des installations:</p>
<blockquote>
<p>minitage_root/category/package/parts/part</p>
</blockquote>
</li>
<li><p class="first">Réutilisabilité de chaque package grace à ce layout</p>
</li>
<li><p class="first">On peut nommer des packages avec leur versions pour autoriser l&#8217;usage de mulitples versions d&#8217;un package donné:</p>
<div class="highlight-python"><pre>/minitage/dependencies/python-2.6</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="id3">
<h1>Le layout pour les dépendances C (categorie: dependencies)<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Minitage utilise -rpath pour hardcoder les chemins de librairies dynamiques.
Le but est de s&#8217;affranchir de LD_LIBRARY_PATH à l&#8217;éxecution</li>
<li>grace à la recette minitage.recipe.cmmi, les flags de compilations sont mis automatiquement dans l&#8217;environnement</li>
</ul>
</div>
<div class="section" id="layout-python-categorie-eggs">
<h1>Layout python  (categorie: eggs)<a class="headerlink" href="#layout-python-categorie-eggs" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Historiquement python va avoir plusieurs mode de déploiements:</p>
<blockquote>
<ul class="simple">
<li>Utiliser un egg ou une source distribution, c&#8217;est le mode préféré de minitage</li>
<li>Utiliser un systeme de build quelquonque pour mettre des chosss dans le site-packges du python cible</li>
</ul>
</blockquote>
</li>
<li><p class="first">Minitage utilise un &#8216;shared egg folder&#8217; pour tous les eggs produits par tous ses projets:</p>
<div class="highlight-python"><pre>/minitage/eggs/cache</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="layout-python-categorie-eggs-2">
<h1>Layout python (categorie: eggs) (2)<a class="headerlink" href="#layout-python-categorie-eggs-2" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Pour quelques packages un peu sioux, on installe dans un repertoire spécifique</p>
<blockquote>
<ul>
<li><p class="first">libxml2, PIL, PyQt, mapnik2:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">minitage</span><span class="o">/</span><span class="n">eggs</span><span class="o">/</span><span class="n">py</span><span class="o">-</span><span class="n">libxml2</span><span class="o">-</span><span class="mf">2.6</span><span class="o">/</span><span class="n">parts</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">-</span><span class="n">pyver</span>
</pre></div>
</div>
</li>
</ul>
</blockquote>
</li>
<li><p class="first">Ne Permettre d&#8217;installer que les seules versions python necessaires pour l&#8217;application.</p>
</li>
<li><p class="first">Dans les buildouts de projets, on utilise <tt class="docutils literal"><span class="pre">eggs-directory</span></tt> pour indiquer le shared cache de minitage.</p>
</li>
</ul>
</div>
<div class="section" id="python-categorie-eggs-3">
<h1>Python  (categorie: eggs) (3)<a class="headerlink" href="#python-categorie-eggs-3" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Pour les projets utilisant directement le site-packages, minitage les installe dans un sous repertoire:</p>
<div class="highlight-python"><pre>/minitage/eggs/package/parts/site-packages-pyver</pre>
</div>
</li>
<li><p class="first">ou si le projet inclut aussi des binaires, etc</p>
<div class="highlight-python"><pre>/minitage/eggs/package/parts/

             site-packages-pyver/site-packages-pyver</pre>
</div>
</li>
</ul>
</div>
<div class="section" id="buildout">
<h1>Buildout<a class="headerlink" href="#buildout" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">minitage est une surcouche à zc.buildout.</p>
</li>
<li><p class="first">Une extension buildout : buildout.minitagificator
Permet:</p>
<blockquote>
<ul>
<li><p class="first">de remplacer à la volée des recettes de la communauté par les équivalents minitage</p>
</li>
<li><p class="first">De mettre si néccesaire les flags de compilation et le path à jour pour l&#8217;environnement global de buildou:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="n">buildout</span><span class="p">]</span>
</pre></div>
</div>
<p>extensions = buildout.minitagicator</p>
</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="buildout-2">
<h1>Buildout (2)<a class="headerlink" href="#buildout-2" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Les recettes intégrent les dépendances d&#8217;un projet dans l&#8217;environnement d&#8217;éxecution de buildout.<ul>
<li>CFLAGS, LDFLAGS, RPATH, CPPFLAGS, PATH, LD_LIBRARY_PATH, PYTHONPATH pour package sioux</li>
<li>minitage.recipe.cmmi &lt;=  zc.recipe.cmmi: compilation de dépendances C</li>
<li>minitage.recipe.{scripts, egg} &lt;= zc.recipe.egg: installation d&#8217;eggs &amp; de distributions python</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="workflow">
<h1>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Planifier et programmer un déploiement, le répeter X fois.</li>
<li>Minitagifier, c&#8217;est assez dur, déployer c&#8217;est facile.</li>
</ul>
</div>
<div class="section" id="workflow-2">
<h1>Workflow (2)<a class="headerlink" href="#workflow-2" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Un expert minitage va donc commencer par:<ul>
<li>Créer le projet et le minitagifier</li>
<li>Versionner ce projet</li>
<li>Créer un minibuild qui pointe vers ce projet</li>
</ul>
</li>
<li>Ensuite et seulement ensuite, les développeurs (utilisateurs) peuvent déployer le projet</li>
</ul>
</div>
<div class="section" id="petites-cachotteries">
<h1>Petites cachotteries<a class="headerlink" href="#petites-cachotteries" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Minitage n&#8217;est pas simple, mais pas tres compliqué non plus, un expert ira plus vite à rendre déployable un projet</li>
<li>Ce meme expert traitera les problemes liés à minitage</li>
<li>Les développeurs (users) n&#8217;ont plus qu&#8217;à télécharger le &#8220;minilay&#8221; et installer le projet.</li>
</ul>
</div>
<div class="section" id="quelques-points-mal-testes-ne-respestant-pas-les-principes-initiaux">
<h1>Quelques points mal testés / ne respestant pas les principes initiaux<a class="headerlink" href="#quelques-points-mal-testes-ne-respestant-pas-les-principes-initiaux" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Mode offline: pas de use case, pas traité mais l&#8217;infrastructure pour le permettre est en place.
Pas difficile à mettre en oeuvre mais avis à contributions.</li>
</ul>
</div>
<div class="section" id="les-libraries-c-et-cpp-et-le-monde-de-rpath">
<h1>Les libraries C, et CPP et le monde de RPATH<a class="headerlink" href="#les-libraries-c-et-cpp-et-le-monde-de-rpath" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Isolation de chaque librairie compilée</li>
<li>LD_LIBRARY_PATH inutile ! vive -rpath</li>
<li>Relocalisation == rebuildd /==/ minitage not relocalisable</li>
</ul>
</div>
<div class="section" id="les-minilays">
<h1>Les minilays<a class="headerlink" href="#les-minilays" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li>Un simple repertoire</li>
<li>Qui contient des &#8220;minibuilds&#8221;</li>
<li>généralement dans &#8220;minitage/minilays&#8221;</li>
</ul>
</div>
<div class="section" id="les-minibuild">
<h1>Les minibuild<a class="headerlink" href="#les-minibuild" title="Permalink to this headline">¶</a></h1>
<ul>
<li><p class="first">Permettent de décrire un package</p>
<blockquote>
<ul class="simple">
<li>Dépendances</li>
<li>Url de téléchargement du package</li>
<li>Méthode d&#8217;installation</li>
</ul>
</blockquote>
</li>
</ul>
</div>
<div class="section" id="les-minibuilds-un-exemple">
<h1>Les minibuilds, un exemple<a class="headerlink" href="#les-minibuilds-un-exemple" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python"><pre>dependencies=py-libxml2-2.7 py-libxslt-1.1 libxml2-2.7 libxslt-1.1 pil-1.1.7 libiconv-1.12 python-2.6
install_method=buildout
src_uri=ssh://git.makina-corpus.net/var/git/plone/project.git
src_type=git
category=zope
homepage=http://www.makina-corpus.com/
description= a plone 4.1.3 buildout
buildout_config=minitage-develop.cfg (optionel)</pre>
</div>
</div>
<div class="section" id="minitage-dance">
<h1>minitage dance<a class="headerlink" href="#minitage-dance" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python"><pre>mkdir -p ~/.buildout/downloads
cat &lt;&lt; EOF &gt; ~/.buildout/default.cfg
[buildout]
download-directory = $HOME/.buildout/downloads
download-cache = $HOME/.buildout/downloads
EOF</pre>
</div>
</div>
<div class="section" id="minitage-dance-2">
<h1>minitage dance (2)<a class="headerlink" href="#minitage-dance-2" title="Permalink to this headline">¶</a></h1>
<div class="highlight-python"><pre>sudo apt-get install build-essential m4 libtool pkg-config autoconf gettext bzip2 groff man-db automake libsigc++-2.0-dev tcl8.5
export prefix=$HOME/minitage
export python=$prefix/tools/python</pre>
</div>
</div>
<div class="section" id="minitage-dance-3">
<h1>minitage dance (3)<a class="headerlink" href="#minitage-dance-3" title="Permalink to this headline">¶</a></h1>
<p>Un python rien que pour minitage</p>
<div class="highlight-python"><pre>wget --no-check-certificate https://github.com/minitage/minitage.shell/raw/master/PyBootstrapper.sh
bash ./PyBootstrapper.sh $python</pre>
</div>
</div>
<div class="section" id="minitage-dance-4">
<h1>minitage dance (4)<a class="headerlink" href="#minitage-dance-4" title="Permalink to this headline">¶</a></h1>
<p>Isolation par virtualenv &amp; installation de minitage &amp; téléchargement des paquets &#8220;core&#8221;</p>
<div class="highlight-python"><pre>$python/bin/virtualenv --no-site-packages --distribute $prefix
source $prefix/bin/activate
easy_install -U minitage.core
minimerge -s</pre>
</div>
</div>
<div class="section" id="minitage-dance-6">
<h1>minitage dance (6)<a class="headerlink" href="#minitage-dance-6" title="Permalink to this headline">¶</a></h1>
<p>On pose le minilay, puis on installe le projet</p>
<div class="highlight-python"><pre>cd minitage/minilays
WGET/git http://minilayurl
minimerge -av projet</pre>
</div>
</div>


      </div>
      <div class="clearer"></div>
    </div> 
  </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="index.html">Minitage - Last updated: Sep 10, 2013</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008 - 2013, Mathieu Le Marec - Pasquet.
      Last updated on Sep 10, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.5.
    </div>
  </body>
</html>